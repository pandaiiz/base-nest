import{N as w,u as P,r as d,F as m,m as q,j as e,D as v,I as S,B as c,b as T,P as O,a as b}from"./index-CaOge65T.js";import{g as p,a as k,u as D}from"./common-CIYGB5T6.js";import{r as I}from"./request-C3tBYgRz.js";import{operationTypes as R}from"./columns-CQ-Wxtz-.js";import{P as E}from"./index-9KecWm-N.js";import{P as V}from"./index-Cz_LybSK.js";import{P as f}from"./index-Cuoo7or1.js";import{P as M}from"./index-nmN99p6a.js";import"./dateUtil-C5Px1K3M.js";async function N(r){return I("/system/dict-item/create-by-dict-code",{method:"POST",data:r})}const A="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let B=(r=21)=>{let l="",o=crypto.getRandomValues(new Uint8Array(r));for(;r--;)l+=A[o[r]&63];return l};const W=w.create(({data:r,type:l="add"})=>{const o=P(),[x,y]=d.useState(!1),n=d.useRef(),[u]=m.useForm(),[j,g]=q.useMessage(),[s,C]=d.useState(),F=async()=>{var a,i;const t=await((i=(a=n.current)==null?void 0:a.validateFields)==null?void 0:i.call(a));l==="add"?await k("io/knife-tool",t):await D(`io/knife-tool/${r.id}`,t),o.resolve(t)};return e.jsxs(v,{placement:"bottom",title:l==="add"?"新增":"编辑",open:o.visible,height:"100%",onClose:o.remove,maskClosable:!1,extra:e.jsx(E,{title:"",icon:!1,onConfirm:async()=>{await N({dictCode:"KNIFE_TOOL",...u.getFieldsValue(),value:B(12)}),j.success("创建成功！"),y(t=>!t)},onOpenChange:()=>u.resetFields(),description:e.jsx(m,{form:u,name:"basic",labelCol:{span:8},wrapperCol:{span:16},autoComplete:"off",children:e.jsx(m.Item,{label:"刀具名称",name:"label",rules:[{required:!0,message:"请输入刀具名称"}],children:e.jsx(S,{})})}),cancelText:"取消",okText:"提交",children:e.jsx(c,{children:"新建刀具"})}),footer:e.jsxs(T,{style:{float:"right"},children:[e.jsx(c,{onClick:()=>o.remove(),children:"取消"}),e.jsx(c,{type:"primary",onClick:F,children:"确定"})]}),children:[g,e.jsxs(O,{formRef:n,initialValues:r||{status:1,quantity:1},labelCol:{span:4},wrapperCol:{span:18},submitter:!1,layout:"horizontal",children:[e.jsx(V.Group,{rules:[{required:!0}],radioType:"button",fieldProps:{buttonStyle:"solid",onChange:t=>C(t.target.value)},name:"operationType",label:"操作类型",options:R}),e.jsx(f,{name:"name",showSearch:!0,label:"刀具名称",rules:[{required:!0}],params:{refresh:x},request:()=>p("system/dict-item/by-dict-code",{dictCode:"KNIFE_TOOL"}),onChange:(t,a)=>{var i,h;(i=n.current)==null||i.setFieldsValue({name:a.title}),(h=n.current)==null||h.setFieldsValue({code:a.value})}}),e.jsx(b,{name:"code",label:"刀具代码",hidden:!0}),e.jsx(M,{name:"quantity",label:"件数",rules:[{required:!0,message:"请输入件数"}],min:1,fieldProps:{precision:0}}),e.jsx(f,{rules:[{required:s!==11&&s!==12&&s!==31}],disabled:s===11||s===12||s===31,name:"supplierId",showSearch:!0,label:"供应商",request:async()=>(await p("relationship/supplier",{pageSize:-1})).map(a=>({label:a.name,value:a.id}))}),e.jsx(f,{rules:[{required:s===11||s===12||s===31}],disabled:s!==11&&s!==12&&s!==31,name:"deptId",showSearch:!0,label:"部门",request:async()=>(await p("system/depts",{pageSize:-1})).map(a=>({label:a.name,value:a.id}))}),e.jsx(b,{name:"remark",label:"备注"})]})]})});export{W as EditModal};
